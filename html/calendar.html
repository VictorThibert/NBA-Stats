<!DOCTYPE html>
<meta charset="utf-8">
<style type="text/css">
  .month {display: inline-block;}


body {
  font: 10px sans-serif;
  shape-rendering: crispEdges;
}

.day {
  fill: #AAA;
}

.fillerday {
  fill: #DDD;
}



.RdYlGn .q0-11{fill:rgb(165,0,38)}
.RdYlGn .q1-11{fill:rgb(215,48,39)}
.RdYlGn .q2-11{fill:rgb(244,109,67)}
.RdYlGn .q3-11{fill:rgb(253,174,97)}
.RdYlGn .q4-11{fill:rgb(254,224,139)}
.RdYlGn .q5-11{fill:rgb(255,255,191)}
.RdYlGn .q6-11{fill:rgb(217,239,139)}
.RdYlGn .q7-11{fill:rgb(166,217,106)}
.RdYlGn .q8-11{fill:rgb(102,189,99)}
.RdYlGn .q9-11{fill:rgb(26,152,80)}
.RdYlGn .q10-11{fill:rgb(0,104,55)}

</style>
<body>

<div id = "calendar">
  <div class = "month" id = "m6"></div>
  <div class = "month" id = "m7"></div>
  <div class = "month" id = "m8"></div>
  <div class = "month" id = "m9"></div>
  <div class = "month" id = "m10"></div>
  <div class = "month" id = "m11"></div>
  <div class = "month" id = "m0"></div>
  <div class = "month" id = "m1"></div>
  <div class = "month" id = "m2"></div>
  <div class = "month" id = "m3"></div>
  <div class = "month" id = "m4"></div>
  <div class = "month" id = "m5"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>

<script>

renderCalendar("6", 2014, 2015); //months are zero indexed
renderCalendar("7", 2014, 2015);
renderCalendar("8", 2014, 2015);
renderCalendar("9", 2014, 2015);
renderCalendar("10", 2014, 2015);
renderCalendar("11", 2014, 2015);
renderCalendar("0", 2015, 2016);
renderCalendar("1", 2015, 2016);
renderCalendar("2", 2015, 2016);
renderCalendar("3", 2015, 2016);
renderCalendar("4", 2015, 2016);
renderCalendar("5", 2015, 2016);

function renderCalendar(container, year1, year2){

  var lastDay = new Date(year1, parseInt(container) + 1, 0);
  var firstDay = new Date(year1, parseInt(container), 1);
  var weekOfLastDay = d3.time.weekOfYear(lastDay) - d3.time.weekOfYear(firstDay);

  var width = 110;

  switch(weekOfLastDay){
    case 3:
      width = 70;
      break;
    case 4:
      width = 87;
      break;
    case 5:
      width = 104;
      break;
  }

  var monthDiv = "#m" + container;


  var height = 136,
      cellSize = 17; // cell size

  var percent = d3.format(".1%"),
      format = d3.time.format("%Y-%m-%d");

  var color = d3.scale.quantize()
      .domain([-.05, .05])
      .range(d3.range(11).map(function(d) { return "q" + d + "-11"; }));

  var svg = d3.select(monthDiv).selectAll("svg")
      .data(d3.range(year1, year2))
    .enter().append("svg")
      .attr("width", width)
      .attr("height", height)
      .attr("class", "RdYlGn")
    .append("g")
      .attr("transform", "translate(" + 0 + "," + (height - cellSize * 7 - 1) + ")");



  svg.append("text")
      .attr("transform", "translate(-6," + cellSize * 3.5 + ")rotate(-90)")
      .style("text-anchor", "middle")
      .text(function(d) { return d; });


  var rect = svg.selectAll(".day")
      .data(function(d) { 
        return d3.time.days(new Date(d, parseInt(container), 1), new Date(d, parseInt(container) + 1, 1)); }) //notice 1 less
    .enter().append("rect")
      .attr("class", "day")
      .attr("width", cellSize - 2)
      .attr("height", cellSize - 2)
      .attr("x", function(d) { return ((d3.time.weekOfYear(d) - d3.time.weekOfYear(d3.time.day(new Date(year1, parseInt(container), 1))) + 52) % 52 * cellSize); }) // week shift
      .attr("y", function(d) { return d.getDay() * cellSize + 1.5; })
      .datum(format);

      var temp = [];

      fillDaysByMonth(parseInt(container), year1);

  function fillDaysByMonth(month, year){

    var fillerdays = [];

    var daysOfMonth = d3.time.days(new Date(year, month, 1), new Date(year, month + 1, 1));

    var first = daysOfMonth[0];
    var last = daysOfMonth[daysOfMonth.length - 1];

    for (var i = 0; i < first.getDay(); i += 1){
      temp.push(d3.time.day(new Date(year1, month, 0 - i)));
    }

    var count = 1;
    for (var i = last.getDay(); i < 6; i += 1 ){
      temp.push(d3.time.day(new Date(year, month + 1, count)));
      count += 1;
    }
  }
  var fillerrect = svg.selectAll(".fillerday")
      .data(temp)
    .enter().append("rect")
      .attr("class", "fillerday")
      .attr("width", cellSize - 2)
      .attr("height", cellSize - 2)
      .attr("x", function(d) { return ((d3.time.weekOfYear(d) - d3.time.weekOfYear(d3.time.day(new Date(year1, parseInt(container), 1))) + 52) % 52 * cellSize); }) //1.2 spacing
      .attr("y", function(d) { return d.getDay() * cellSize + 1.5; })
      .datum(format);




  rect.append("title")
      .text(function(d) { return d; });

  svg.selectAll(".month")
      .data(function(d) { return d3.time.months(new Date(d, 10, 1), new Date(d + 1, 4, 32)); })
    .enter().append("path")
      .attr("class", "month")
     // .attr("d", monthPath);

  // d3.csv("dji.csv", function(error, csv) {
  //   if (error) throw error;

  //   var data = d3.nest()
  //     .key(function(d) { return d.Date; })
  //     .rollup(function(d) { return (d[0].Close - d[0].Open) / d[0].Open; })
  //     .map(csv);

  //   rect.filter(function(d) { return d in data; })
  //       .attr("class", function(d) { return "day " + color(data[d]); })
  //     .select("title")
  //       .text(function(d) { return d + ": " + percent(data[d]); });
  // });

  function monthPath(t0) { //called once per month //t0 is the date of the first day of the month
    var t1 = new Date(t0.getFullYear(), t0.getMonth() + 1, 0),
        d0 = t0.getDay(), w0 = (d3.time.weekOfYear(t0) - 43 + 52) % 52,
        d1 = t1.getDay(), w1 = (d3.time.weekOfYear(t1) - 43 + 52) % 52;


    return "M" + (w0 + 1) * cellSize + "," + d0 * cellSize
        + "H" + w0 * cellSize + "V" + 7 * cellSize
        + "H" + w1 * cellSize + "V" + (d1 + 1) * cellSize
        + "H" + (w1 + 1) * cellSize + "V" + 0
        + "H" + (w0 + 1) * cellSize + "Z";
  }

  d3.select(self.frameElement).style("height", "2910px");
}

</script>