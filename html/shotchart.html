<!DOCTYPE HTML>
<meta charset="utf-8">
<html>

	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="../scripts/hexbin.js"></script>

	<head>
		<title>Shot Chart Test</title>
		<link rel="shortcut icon" href="http://events.cleantech.com/wp-content/uploads/2014/08/Cleantech_Hexagons-300x300-300x300.png">
	</head>

	<style>

		.axis text {
		  font: 10px sans-serif;
		}

		.axis path,
		.axis line {
		  fill: none;
		  stroke: #000;
		  shape-rendering: crispEdges;
		}

		.hexagon {
		  fill: none;
		  stroke: #000;
		  stroke-width: 0px;
		}


	</style>
	<body>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
		<script src="../scripts/hexbin.js"></script>
		<script>
			var arr = [];
			var arr2 = [];
			var arr3 = [];
			var xmlhttp = new XMLHttpRequest();
			var url = "http://localhost/webserver/php/playershotsAll.php?"; //(AL HORFORD: 201143) (PAUL MILLSAP: 200794)
			xmlhttp.onreadystatechange=function() {
			    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			        myFunction(xmlhttp.responseText);
			    }}
			xmlhttp.open("GET", url, true);
			xmlhttp.send();

			function myFunction(response) {
			    arr = JSON.parse(response); 
			    tempReassign();
			}
			
			function tempReassign(){
				for (var i = 0; i < arr.length; i++) {
					//arr2[i] = [parseInt(arr[i]["LOC_X"]), parseInt(arr[i]["LOC_Y"])];
					//arr2.push([parseInt(arr[i]["LOC_X"]) + 250, parseInt(arr[i]["LOC_Y"]) + 50]);
					arr3.push([2*(parseInt(arr[i]["LOC_X"]) + 250), parseInt(2*(arr[i]["LOC_Y"]) + 50), parseInt(arr[i]["SHOT_MADE_FLAG"])]);
				}
				render();
			}
		</script>
		<script>
			function render(){

				var margin = {top: 20, right: 20, bottom: 30, left: 40}, //MARGIN
				    width = 2000 - margin.left - margin.right,
				    height = 1200 - margin.top - margin.bottom; 

				var radiusScale = d3.scale.pow().exponent(0.2)  //RADIUS SCALE QUANTIZE
				    .domain([0,40000])
				    .range([0.5,4]); 

				var points = arr3;

				var colorScale = d3.scale.linear() //GENERATE COLOUR SCALE
				    .domain([0, 0.5, 1])
				    .range(["yellow", "red", "DarkRed"])
				    .interpolate(d3.interpolateLab); //Interpolating function for colours

				var x = d3.scale.identity() //AXIS STUFF
				    .domain([0, width])
				    ; 
				var y = d3.scale.linear()
				    .domain([0, height])
				    .range([height, 0]);
				var xAxis = d3.svg.axis()
				    .scale(x)
				    .orient("bottom")
				    .tickSize(6, -height);
				var yAxis = d3.svg.axis()
				    .scale(y)
				    .orient("left")
				    .tickSize(6, -width);

				var hexbin = d3.hexbin()
				    .size([width, height])
				    .radius(2.6);			    

				var svg = d3.select("body").append("svg") //FIRST SVG CANVAS
				    .attr("width", width + margin.left + margin.right)
				    .attr("height", height + margin.top + margin.bottom)
				  .append("g")
				    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

				svg.append("clipPath")//ADD CLIPATH TO GRAPH AREA
				    .attr("id", "clip")
				  .append("rect")
				    .attr("class", "mesh")
				    .attr("width", width)
				    .attr("height", height);
				svg.append("g") //ADDING THE HEXAGONS
				    .attr("clip-path", "url(#clip)") //Does nothing ?
				  .selectAll(".hexagon")
				    .data(hexbin(points))
				 	.enter()
				  	.append("path")
				    .attr("class", "hexagon")
				   // .attr("d", hexbin.hexagon())
				    .attr("d", function(d) { 
					    return hexbin.hexagon(radiusScale(d.length), 10)["dpoints"];})  //d data element is the data contained in hexagon (hexbin) [ [x,y,made], [x,y,made] ]  //ACCESS HERE
				    .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
				    .on("mouseover", function(d) {
				       d3.select(this)
         				 .style("fill", "orange");
				    })
				    .on("mouseout", function(d) {
				      d3.select(this)
				      	.transition()
     					.duration(250)
				     	.style("fill", function(d) {return colorScale(d.totalMade/d.totalShot); });
					})
				    .style("fill", function(d) {return colorScale(d.totalMade/d.totalShot); })
				    .append("title")
				    .text(function(d) {
				         return d.totalMade+"/"+d.totalShot;
				    });


				// svg.append("g") //APPEND X AXIS
				//     .attr("class", "y axis")
				//     .call(yAxis);
				// svg.append("g") //APPEND Y AXIS
				//     .attr("class", "x axis")
				//     .attr("transform", "translate(0," + height + ")")
				//     .call(xAxis);
			}
		</script>
	</body>
</html>